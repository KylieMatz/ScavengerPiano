<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Piano Puzzle</title>
<style>
  :root{ --keyH:28vh; --pianoPad:12px; --xmasRed:#8B1D2C; --xmasGreen:#0E5137; }
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff;min-height:100svh;overflow:hidden;position:relative;
    background:
      radial-gradient(900px 650px at 20% 10%, rgba(255,255,255,0.10), rgba(255,255,255,0) 60%),
      radial-gradient(900px 650px at 80% 20%, rgba(255,255,255,0.08), rgba(255,255,255,0) 62%),
      repeating-linear-gradient(135deg,
        color-mix(in srgb, var(--xmasRed) 55%, black 45%) 0px,
        color-mix(in srgb, var(--xmasRed) 55%, black 45%) 200px,
        color-mix(in srgb, var(--xmasGreen) 55%, black 45%) 200px,
        color-mix(in srgb, var(--xmasGreen) 55%, black 45%) 400px);}
  body::before{content:"";position:fixed;inset:-60px;z-index:0;pointer-events:none;
    background:radial-gradient(1100px 900px at 25% 25%, rgba(255,255,255,0.06), rgba(255,255,255,0) 60%),
             radial-gradient(1100px 900px at 70% 65%, rgba(255,255,255,0.05), rgba(255,255,255,0) 62%),
             linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.12));
    filter:blur(20px);}
  .snow{position:fixed;inset:0;pointer-events:none;opacity:0.95;z-index:1;}
  .flake{position:absolute;top:-10vh;width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.92);box-shadow:0 0 10px rgba(255,255,255,0.18);animation:fall linear infinite;}
  @keyframes fall{to{transform:translate3d(var(--dx),115vh,0);}}
  .wrap{min-height:100svh;display:flex;flex-direction:column;padding-bottom:calc(var(--keyH)+24px);box-sizing:border-box;position:relative;z-index:2;}
.lyrics-area{
  flex: 1;
  display: flex;
  align-items: flex-start;     /* TOP align instead of center */
  justify-content: center;
  padding: 18px;
  padding-top: 28px;           /* pushes it down a touch so nothing clips */
  box-sizing: border-box;
  max-height: calc(100svh - var(--keyH) - 60px);
  overflow: auto;
}
}
  .lyrics{width:min(900px,94vw);background:rgba(0,0,0,0.18);border:1px solid rgba(255,255,255,0.22);border-radius:22px;padding:20px 18px;
    font-size:clamp(26px,3.8vw,40px);font-weight:900;line-height:1.22;letter-spacing:0.2px;white-space:pre-line;text-align:center;text-shadow:0 8px 20px rgba(0,0,0,0.35);backdrop-filter:blur(6px);}
  .done{display:none;flex:1;align-items:center;justify-content:center;padding:18px;box-sizing:border-box;}
  .card{width:min(900px,94vw);background:rgba(0,0,0,0.20);border:1px solid rgba(255,255,255,0.22);border-radius:22px;padding:20px 18px;
    font-size:clamp(24px,3.4vw,38px);font-weight:900;line-height:1.22;text-align:center;text-shadow:0 8px 20px rgba(0,0,0,0.35);backdrop-filter:blur(6px);}
  .piano{position:fixed;left:0;right:0;bottom:0;padding:var(--pianoPad);background:rgba(8,8,10,0.70);backdrop-filter:blur(12px);border-top:1px solid rgba(255,255,255,0.18);z-index:3;}
  .piano-inner{max-width:980px;margin:0 auto;position:relative;height:var(--keyH);}
  .white-keys{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;height:100%;}
  .white{position:relative;border-radius:14px;border:1px solid rgba(0,0,0,0.45);background:linear-gradient(#ffffff,#ececf2);user-select:none;-webkit-user-select:none;touch-action:manipulation;overflow:hidden;}
  .white.active-green{outline:4px solid rgba(44,198,110,0.98);} .white.active-red{outline:4px solid rgba(255,50,70,0.98);}
  .start-pulse{animation:pulse 1.05s infinite;} @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(44,198,110,0.0);}45%{box-shadow:0 0 0 12px rgba(44,198,110,0.26);}100%{box-shadow:0 0 0 0 rgba(44,198,110,0.0);}}
  .start-arrow{position:absolute;top:-22px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:18px solid rgba(44,198,110,0.98);filter:drop-shadow(0 4px 10px rgba(0,0,0,0.35));pointer-events:none;}
  .black-keys{position:absolute;left:0;right:0;top:0;height:60%;pointer-events:none;}
  .black{pointer-events:auto;position:absolute;width:10.5%;height:100%;border-radius:12px;background:linear-gradient(#2a2a2f,#0d0d10);border:1px solid rgba(255,255,255,0.12);user-select:none;-webkit-user-select:none;touch-action:manipulation;}
  .black.active-green{outline:4px solid rgba(44,198,110,0.98);} .black.active-red{outline:4px solid rgba(255,50,70,0.98);}
  .b-cs{left:8.25%;}.b-ds{left:20.75%;}.b-fs{left:45.75%;}.b-gs{left:58.25%;}.b-as{left:70.75%;}
</style>
</head>
<body>
<div class="snow" id="snow"></div>

<div class="wrap">
  <div class="lyrics-area" id="playScreen">
    <div class="lyrics">"__ ____ _____, ___ _____ ___ ________ _______,
It is the night of our dear saviors birth.
Long lay the world in sin and error pining."</div>
  </div>
  <div class="done" id="doneScreen"><div class="card" id="clueText">TEAM 4 CLUE PLACEHOLDER</div></div>
</div>

<div class="piano" id="pianoBar">
  <div class="piano-inner">
    <div class="white-keys">
      <div class="white" data-note="C4" onclick="press('C4')"></div>
      <div class="white" data-note="D4" onclick="press('D4')"></div>
      <div class="white" data-note="E4" onclick="press('E4')"></div>
      <div class="white" data-note="F4" onclick="press('F4')"></div>
      <div class="white" data-note="G4" onclick="press('G4')"></div>
      <div class="white" data-note="A4" onclick="press('A4')"></div>
      <div class="white" data-note="B4" onclick="press('B4')"></div>
      <div class="white" data-note="C5" onclick="press('C5')"></div>
    </div>
    <div class="black-keys">
      <div class="black b-cs" data-note="C#4" onclick="press('C#4')"></div>
      <div class="black b-ds" data-note="D#4" onclick="press('D#4')"></div>
      <div class="black b-fs" data-note="F#4" onclick="press('F#4')"></div>
      <div class="black b-gs" data-note="G#4" onclick="press('G#4')"></div>
      <div class="black b-as" data-note="A#4" onclick="press('A#4')"></div>
    </div>
  </div>
</div>

<script>
  document.getElementById("clueText").textContent="TEAM 4 CLUE PLACEHOLDER â€” replace with your next clue.";

  // Notes: E E E G | G A A F A C' G  (C' = C5)
  const TARGET=["E4","E4","E4","G4","G4","A4","A4","F4","A4","C5","G4"];

  (function makeSnow(){
    const snow=document.getElementById("snow"), flakes=34;
    for(let i=0;i<flakes;i++){
      const f=document.createElement("div"); f.className="flake";
      const left=Math.random()*100,size=3+Math.random()*7,dur=6+Math.random()*8,dx=(Math.random()*60-30)+"vw",delay=(-Math.random()*dur)+"s";
      f.style.left=left+"vw"; f.style.width=size+"px"; f.style.height=size+"px"; f.style.setProperty("--dx",dx);
      f.style.animationDuration=dur+"s"; f.style.animationDelay=delay; f.style.opacity=(0.30+Math.random()*0.60).toFixed(2);
      snow.appendChild(f);
    }
  })();

  let ac=null;
  const freq={"C4":261.63,"C#4":277.18,"D4":293.66,"D#4":311.13,"E4":329.63,"F4":349.23,"F#4":369.99,"G4":392.00,"G#4":415.30,"A4":440.00,"A#4":466.16,"B4":493.88,"C5":523.25};
  function ensureAC(){ if(!ac) ac=new (window.AudioContext||window.webkitAudioContext)(); if(ac.state==="suspended") ac.resume(); }
  function play(note,ms=220){
  ensureAC();
  const o = ac.createOscillator();
  const g = ac.createGain();

  o.type = "triangle";
  o.frequency.value = freq[note] ?? 440;

  const now = ac.currentTime;

  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(0.22, now + 0.02);   // louder
  g.gain.exponentialRampToValueAtTime(0.0001, now + ms/1000);

  o.connect(g);
  g.connect(ac.destination);

  o.start(now);
  o.stop(now + ms/1000 + 0.05);
}
  
  let idx=0;
  function keyEl(note){ return document.querySelector(`[data-note="${CSS.escape(note)}"]`); }
  function setStartIndicator(note){
    document.querySelectorAll(".start-arrow").forEach(x=>x.remove());
    document.querySelectorAll(".start-pulse").forEach(x=>x.classList.remove("start-pulse"));
    const el=keyEl(note); if(!el) return;
    el.classList.add("active-green","start-pulse");
    const arrow=document.createElement("div"); arrow.className="start-arrow"; el.appendChild(arrow);
  }
  function clearStartIndicator(note){
    const el=keyEl(note); if(!el) return;
    el.classList.remove("active-green","start-pulse");
    const arrow=el.querySelector(".start-arrow"); if(arrow) arrow.remove();
  }
  setStartIndicator(TARGET[0]);

  function blink(note,cls,times=3,interval=140){
    const el=keyEl(note); if(!el) return;
    let t=0;
    const id=setInterval(()=>{ el.classList.toggle(cls); t++; if(t>=times*2){ el.classList.remove(cls); clearInterval(id);} },interval);
  }

  function press(note){
    play(note);
    const expected=TARGET[idx];

    if(note===expected){
      if(idx===0) clearStartIndicator(TARGET[0]);
      const el=keyEl(note); if(el){ el.classList.add("active-green"); setTimeout(()=>el.classList.remove("active-green"),160); }
      idx++; if(idx>=TARGET.length) unlock(); return;
    }

    blink(note,"active-red",3,140);
    blink(expected,"active-green",3,140);
    idx=0; setTimeout(()=>setStartIndicator(TARGET[0]),520);
  }

  function unlock(){
    document.getElementById("playScreen").style.display="none";
    document.getElementById("doneScreen").style.display="flex";
    document.getElementById("pianoBar").style.display="none";
  }
</script>
</body>
</html>
