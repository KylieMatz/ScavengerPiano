<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team 1 – Piano Puzzle</title>
  <style>
    :root { --keyH: 26vh; --pianoPad: 14px; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #0f0f12;
      color: #f5f5f7;
    }

    .wrap {
      min-height: 100svh;
      display: flex;
      flex-direction: column;
      padding-bottom: calc(var(--keyH) + 32px);
    }

    .top {
      padding: 22px 18px 12px;
      max-width: 860px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 10px;
      font-size: 22px;
      font-weight: 850;
      letter-spacing: 0.2px;
    }

    .lyrics {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 14px 14px;
      font-size: 16px;
      line-height: 1.4;
      white-space: pre-line;
    }

    .meta {
      margin-top: 12px;
      font-size: 13px;
      opacity: 0.75;
      line-height: 1.35;
    }

    .status {
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.9;
      font-weight: 650;
    }

    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
    .btn {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.16);
      color: #f5f5f7;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 750;
      font-size: 14px;
      cursor: pointer;
    }

    /* Reveal screen */
    .done { display: none; padding: 18px; }
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 16px;
    }
    .card h2 { margin: 0 0 8px; font-size: 18px; }
    .card p { margin: 0; font-size: 16px; line-height: 1.4; }

    /* Piano bar */
    .piano {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: var(--pianoPad);
      background: rgba(10,10,12,0.92);
      backdrop-filter: blur(8px);
      border-top: 1px solid rgba(255,255,255,0.12);
    }
    .piano-inner {
      max-width: 980px;
      margin: 0 auto;
      position: relative;
      height: var(--keyH);
    }

    .white-keys {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 6px;
      height: 100%;
    }

    .white {
      position: relative;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.35);
      background: linear-gradient(#ffffff, #e9e9ee);
      color: rgba(0,0,0,0.65);
      font-weight: 800;
      font-size: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 10px;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      overflow: hidden;
    }

    /* no note labels */
    .white::after { content: ""; }

    .white.active-green { outline: 4px solid rgba(44, 198, 110, 0.95); }
    .white.active-red   { outline: 4px solid rgba(255, 77, 77, 0.95); }

    /* Start indicator: pulsing glow + arrow */
    .start-pulse {
      box-shadow: 0 0 0 0 rgba(44, 198, 110, 0.0);
      animation: pulse 1.15s infinite;
    }
    @keyframes pulse {
      0%   { box-shadow: 0 0 0 0 rgba(44, 198, 110, 0.0); }
      40%  { box-shadow: 0 0 0 8px rgba(44, 198, 110, 0.22); }
      100% { box-shadow: 0 0 0 0 rgba(44, 198, 110, 0.0); }
    }

    .start-arrow {
      position: absolute;
      top: -22px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 18px solid rgba(44, 198, 110, 0.95);
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.35));
      opacity: 0.95;
      pointer-events: none;
    }

    /* Black keys (optional, kept for realism, not used in Jingle Bells here) */
    .black-keys { position: absolute; left: 0; right: 0; top: 0; height: 60%; pointer-events: none; }
    .black {
      pointer-events: auto;
      position: absolute;
      width: 10.5%;
      height: 100%;
      border-radius: 12px;
      background: linear-gradient(#2a2a2f, #0d0d10);
      border: 1px solid rgba(255,255,255,0.08);
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }
    .black.active-green { outline: 4px solid rgba(44, 198, 110, 0.95); }
    .black.active-red   { outline: 4px solid rgba(255, 77, 77, 0.95); }
    .b-cs { left: 8.25%; } .b-ds { left: 20.75%; } .b-fs { left: 45.75%; } .b-gs { left: 58.25%; } .b-as { left: 70.75%; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top" id="playScreen">
      <h1>Team 1</h1>

      <div class="lyrics">
______ _____, ______ _____, ______ ___ ___ ___
oh what fun it is to ride in a one horse open sleigh!
      </div>

      <div class="meta">
        Tap the piano keys in the correct order (no timing needed).<br/>
        If you hit a wrong note: it flashes <span style="color:#ff4d4d;font-weight:800;">red</span>, the correct next note flashes <span style="color:#2cc66e;font-weight:800;">green</span>, and your progress resets.
      </div>

      <div class="status" id="status">Progress: 0 / 11</div>

      <div class="row">
        <button class="btn" onclick="resetPuzzle()">Reset</button>
      </div>
    </div>

    <div class="done" id="doneScreen">
      <div class="top">
        <div class="card">
          <h2>Unlocked ✅</h2>
          <p id="clueText"><strong>TEAM 1 CLUE PLACEHOLDER</strong></p>
        </div>
      </div>
    </div>
  </div>

  <div class="piano" id="pianoBar">
    <div class="piano-inner">
      <div class="white-keys">
        <div class="white" data-note="C4" onclick="press('C4')"></div>
        <div class="white" data-note="D4" onclick="press('D4')"></div>
        <div class="white" data-note="E4" onclick="press('E4')"></div>
        <div class="white" data-note="F4" onclick="press('F4')"></div>
        <div class="white" data-note="G4" onclick="press('G4')"></div>
        <div class="white" data-note="A4" onclick="press('A4')"></div>
        <div class="white" data-note="B4" onclick="press('B4')"></div>
        <div class="white" data-note="C5" onclick="press('C5')"></div>
      </div>

      <div class="black-keys">
        <div class="black b-cs" data-note="C#4" onclick="press('C#4')"></div>
        <div class="black b-ds" data-note="D#4" onclick="press('D#4')"></div>
        <div class="black b-fs" data-note="F#4" onclick="press('F#4')"></div>
        <div class="black b-gs" data-note="G#4" onclick="press('G#4')"></div>
        <div class="black b-as" data-note="A#4" onclick="press('A#4')"></div>
      </div>
    </div>
  </div>

<script>
  // ====== Replace this clue later ======
  const REVEALED_CLUE = "TEAM 1 CLUE PLACEHOLDER — replace with your next location/clue text.";
  document.getElementById("clueText").innerHTML = "<strong>" + REVEALED_CLUE + "</strong>";

  // ====== Jingle Bells opening (11 notes) ======
  // E E E | E E E | E G C D E
  const TARGET = ["E4","E4","E4","E4","E4","E4","E4","G4","C4","D4","E4"];

  // ====== Audio (softer, less 'beepy') ======
  let ctx = null;
  const freq = {
    "C4":261.63,"C#4":277.18,"D4":293.66,"D#4":311.13,"E4":329.63,"F4":349.23,"F#4":369.99,
    "G4":392.00,"G#4":415.30,"A4":440.00,"A#4":466.16,"B4":493.88,"C5":523.25
  };

  function audio() {
    if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
    return ctx;
  }

  function play(note, ms=170) {
    const ac = audio();
    const o = ac.createOscillator();
    const g = ac.createGain();

    // Warmer than sine; still reliable on iPhone
    o.type = "triangle";
    o.frequency.value = freq[note] ?? 440;

    const now = ac.currentTime;

    // Softer piano-ish envelope
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.18, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + ms/1000);

    o.connect(g);
    g.connect(ac.destination);

    o.start(now);
    o.stop(now + ms/1000 + 0.03);
  }

  // ====== Puzzle logic ======
  let i = 0;
  const statusEl = document.getElementById("status");

  function keyEl(note) {
    return document.querySelector(`[data-note="${CSS.escape(note)}"]`);
  }

  function flash(note, cls, duration=420) {
    const el = keyEl(note);
    if (!el) return;
    el.classList.add(cls);
    setTimeout(() => el.classList.remove(cls), duration);
  }

  function setStartIndicator(note) {
    // clear existing indicators
    document.querySelectorAll(".start-arrow").forEach(x => x.remove());
    document.querySelectorAll(".start-pulse").forEach(x => x.classList.remove("start-pulse"));

    const el = keyEl(note);
    if (!el) return;

    el.classList.add("start-pulse");
    const arrow = document.createElement("div");
    arrow.className = "start-arrow";
    el.appendChild(arrow);
  }

  // Start arrow points to the first required note until they begin
  setStartIndicator(TARGET[0]);

  function press(note) {
    play(note);

    const expected = TARGET[i];

    if (note === expected) {
      flash(note, "active-green", 220);
      i++;

      statusEl.textContent = `Progress: ${i} / ${TARGET.length}`;

      // If they haven't started yet, remove pulse after first correct press
      if (i === 1) {
        // remove indicator once they've started
        document.querySelectorAll(".start-arrow").forEach(x => x.remove());
        document.querySelectorAll(".start-pulse").forEach(x => x.classList.remove("start-pulse"));
      }

      if (i >= TARGET.length) unlock();
      return;
    }

    // wrong note: show red on tapped, green on correct next, then reset progress
    flash(note, "active-red", 450);
    flash(expected, "active-green", 700);

    i = 0;
    statusEl.textContent = `Progress: ${i} / ${TARGET.length}`;

    // show the start indicator again
    setStartIndicator(TARGET[0]);
  }

  function resetPuzzle() {
    i = 0;
    statusEl.textContent = `Progress: ${i} / ${TARGET.length}`;
    setStartIndicator(TARGET[0]);
  }

  function unlock() {
    document.getElementById("playScreen").style.display = "none";
    document.getElementById("doneScreen").style.display = "block";
    document.getElementById("pianoBar").style.display = "none";
  }
</script>
</body>
</html>
